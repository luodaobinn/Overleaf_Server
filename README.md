# Overleaf Server ä½¿ç”¨è¯´æ˜

æœ¬æ–‡æ¡£æ—¨åœ¨æŒ‡å¯¼å¦‚ä½•ä½¿ç”¨ Overleaf Serverï¼Œä»¥åŠååŠ©ç®¡ç†å‘˜è¿›è¡Œç³»ç»Ÿçš„ç»´æŠ¤ä¸ç®¡ç†ã€‚

## ğŸ“– ç”¨æˆ·æŒ‡å— 

### ä¸€ã€ æ³¨å†Œ

å¦‚æœæ‚¨æ˜¯é¦–æ¬¡ä½¿ç”¨ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®Œæˆæ³¨å†Œï¼š

1. è®¿é—®æ³¨å†Œé¡µé¢ï¼š http://192.168.31.76:6086
2. ç‚¹å‡»é¡µé¢ å·¦ä¸‹è§’ çš„ æ³¨å†Œ é“¾æ¥ã€‚
3. å¡«å†™æ‚¨çš„é‚®ç®±åœ°å€ã€‚
4. è¿›å…¥é“¾æ¥è®¾ç½®æ‚¨çš„ç™»å½•å¯†ç ã€‚

### äºŒã€ ç™»å½•

è¯·æ ¹æ®æ‚¨å½“å‰çš„ç½‘ç»œç¯å¢ƒé€‰æ‹©åˆé€‚çš„è®¿é—®åœ°å€ï¼š

| ç½‘ç»œç¯å¢ƒ | è®¿é—®åœ°å€ (URL) | å¤‡æ³¨ |
| --- | --- | --- |
| å®éªŒå®¤å±€åŸŸç½‘ | http://192.168.31.76:6086/login | ç¨³å®šï¼Œä»…é™å®éªŒå®¤å†…ç½‘ |
| å…¬ç½‘ (å¤–éƒ¨è®¿é—®) | è¯·è”ç³»ç®¡ç†å‘˜ | ä»»æ„ç½‘ç»œå¯ç”¨ |

### ä¸‰ã€ å¤šäººåä½œ

æ”¯æŒ é‚®ç®±é‚€è¯·ã€é“¾æ¥åˆ†äº« æ¨¡å¼è¿›è¡Œåä½œã€‚

- é‚®ç®±é‚€è¯· ï¼šåœ¨é¡¹ç›®ä¸­ç‚¹å‡» Shareï¼Œæ·»åŠ åä½œè€…é‚®ç®±é‚€è¯·å³å¯ã€‚
- é“¾æ¥åˆ†äº« ï¼šåœ¨é¡¹ç›®ä¸­ç‚¹å‡» Shareï¼Œæ‰“å¼€å¹¶å¤åˆ¶åˆ†äº«é“¾æ¥å‘é€ç»™åä½œè€…ã€‚

> âš ï¸ æ³¨æ„äº‹é¡¹ï¼š
> 1.é‚®ç®±é‚€è¯·æ—¶ï¼Œåä½œè€…å¿…é¡»åœ¨æœ¬æœåŠ¡å™¨æ³¨å†Œè¿‡ï¼Œç™»å½•è‡ªå·±è´¦å·ç‚¹å‡»æ¥å—é‚€è¯·ï¼›
> 2.é“¾æ¥åˆ†äº«æ—¶ï¼Œå¦‚æœè¢«åˆ†äº«çš„åä½œè€…ä¸åœ¨å®éªŒå®¤å±€åŸŸç½‘å†…ï¼Œè¯·åŠ¡å¿…æ‰‹åŠ¨å°†é“¾æ¥ä¸­çš„å†…ç½‘ IP (
> 192.168.31.76:6086
> ) æ›¿æ¢ä¸ºå…¬ç½‘ IPï¼Œå¦åˆ™å¯¹æ–¹æ— æ³•æ‰“å¼€ã€‚

## ğŸ”§ ç®¡ç†å‘˜æŒ‡å— (Administrator Guide)

### ä¸€ã€ é¡¹ç›®å¯åœ (æ ¸å¿ƒæœåŠ¡)

å¯åŠ¨æ‰€æœ‰æœåŠ¡ (Overleaf ä¸»æœåŠ¡ + æ³¨å†Œåç«¯)ï¼š

```bash
toolkit-master/bin/up -d && toolkit-master/bin/run-register start
```

åœæ­¢æ‰€æœ‰æœåŠ¡ ï¼š

```bash
toolkit-master/bin/stop && toolkit-master/bin/run-register stop
```

### äºŒã€ æ³¨å†ŒåŠŸèƒ½ç®¡ç†

æœ¬é¡¹ç›®é›†æˆäº†ä¸€ä¸ªé¢å¤–çš„ Flask åç«¯ ( ./app.py ) ä»¥å®ç°ç”¨æˆ·è‡ªåŠ©æ³¨å†ŒåŠŸèƒ½ï¼ˆåŸç‰ˆä»…æ”¯æŒç®¡ç†å‘˜åå°åˆ›å»ºï¼‰ã€‚è¯¥æ¨¡å—é€šè¿‡ toolkit-master/run-register è„šæœ¬è¿›è¡Œç®¡ç†ã€‚

| æ“ä½œ | å‘½ä»¤ |
| --- | --- |
| å¯åŠ¨åç«¯ | ./toolkit-master/run-register start |
| åœæ­¢åç«¯ | ./toolkit-master/run-register stop |
| é‡å¯åç«¯ | ./toolkit-master/run-register restart |
| æŸ¥çœ‹çŠ¶æ€ | ./toolkit-master/run-register status |
| å®æ—¶æ—¥å¿— | ./toolkit-master/run-register logs |
| æŸ¥çœ‹å¸®åŠ© | ./toolkit-master/run-register help |

### ä¸‰ã€ æ•°æ®å¤‡ä»½ä¸å›æº¯

#### 1. æ•°æ®å¤‡ä»½

æ‰§è¡Œä»¥ä¸‹è„šæœ¬ï¼Œå¤‡ä»½æ–‡ä»¶å°†ç”Ÿæˆåœ¨ ./backups ç›®å½•ä¸‹ï¼š

```bash
./toolkit-master/backup.sh
```

#### 2. æ•°æ®å›æº¯

æ‰§è¡Œå›æº¯è„šæœ¬ã€‚ æ³¨æ„ ï¼šéœ€è¦åœ¨è„šæœ¬æ–‡ä»¶ä¸­é¢„å…ˆé…ç½®å¤‡ä»½è·¯å¾„ï¼Œå¹¶æ ¹æ®æç¤ºæ‰‹åŠ¨ç¡®è®¤ã€‚

```bash
./toolkit-master/restore.sh
```

> âš ï¸ å›æº¯åæƒé™ä¿®å¤ï¼š
> å›æº¯å®Œæˆåï¼Œå¿…é¡»æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¿®å¤æ•°æ®ç›®å½•æƒé™ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æœåŠ¡æ— æ³•è¯»å†™ï¼š

 ```bash
sudo chmod -R 777 ./toolkit-master/data
```

### å››ã€ ç³»ç»Ÿè¿ç§»æŒ‡å— 

æ³¨ï¼šç›®å‰å°šæœªå®æ“éªŒè¯ï¼Œä»¥ä¸‹ä¸ºå»ºè®®æµç¨‹ã€‚

è‹¥éœ€å°†æœåŠ¡è¿ç§»è‡³æ–°æœåŠ¡å™¨ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. é•œåƒæ‰“åŒ… ï¼š æ‰“åŒ… Docker é•œåƒ sharelatex/sharelatex:6.0.1-ext-v3.4-with-texlive-full ï¼ˆæ­¤é•œåƒå·²åŒ…å« Overleaf ç¤¾åŒºç‰ˆæ‰©å±•æ‰¹æ³¨åŠŸèƒ½åŠå®Œæ•´ TeXLive åŒ…ï¼‰ã€‚
2. æ•°æ®å¤‡ä»½ ï¼š ä½¿ç”¨ä¸Šè¿°â€œå¤‡ä»½åŠŸèƒ½â€å¯¹å½“å‰æ•°æ®è¿›è¡Œå…¨é‡å¤‡ä»½ã€‚
3. é¡¹ç›®è¿ç§» ï¼š æ‰“åŒ…å¹¶ä¼ è¾“æ•´ä¸ª Overleaf_Server é¡¹ç›®ç›®å½•è‡³æ–°æœåŠ¡å™¨ã€‚
4. æ•°æ®æ¢å¤ ï¼š åœ¨æ–°æœåŠ¡å™¨ä¸Šæ‰§è¡Œâ€œå›æº¯åŠŸèƒ½â€åŠ è½½æ•°æ®ã€‚
5. é…ç½®æ›´æ–° ï¼š å¯åŠ¨é¡¹ç›®å‰ï¼ŒåŠ¡å¿…æ£€æŸ¥å¹¶ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ä¸­çš„ IP å’Œç«¯å£é…ç½®ï¼š ./toolkit-master/lib/docker-compose.base.yml ./app.py
6. å¯åŠ¨æœåŠ¡ ï¼š æŒ‰ç…§â€œé¡¹ç›®å¯åŠ¨â€æ­¥éª¤æ‹‰èµ·æœåŠ¡ã€‚

### äº”ã€Systemd æœåŠ¡å¸¸ç”¨æ“ä½œæŒ‡å—ï¼ˆå¯åŠ¨/åœæ­¢/æŸ¥çœ‹æ—¥å¿—ï¼‰

æ³¨ï¼šç›®å‰å·²ç»é…ç½®æœåŠ¡çš„å¼€æœºè‡ªå¯ã€æŠ¥é”™é‡å¯

1. æ—¥å¿—æ’æŸ¥ï¼ˆå®æ—¶ï¼‰
```bash
journalctl -u frpc -f 
```
```bash
journalctl -u overleaf -f
```

3. å¯åŠ¨æœåŠ¡
```bash
sudo systemctl start frpc
```
```bash
sudo systemctl start overleaf
```
5. åœæ­¢æœåŠ¡
```bash
sudo systemctl stop frpc
```
```bash
sudo systemctl stop overleaf
```
6. é‡å¯æœåŠ¡
```bash
sudo systemctl restart frpc
```
```bash
sudo systemctl restart overleaf
```
7. è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆç›®å‰å·²è®¾ç½®ï¼‰
```bash
sudo systemctl enable frpc
```
```bash
sudo systemctl enable overleaf
```
8. å–æ¶ˆå¼€æœºè‡ªå¯
```bash
sudo systemctl disable frpc
```
```bash
sudo systemctl disable overleaf
```
9. é‡è½½systemdé…ç½®ï¼ˆä¿®æ”¹å¯åŠ¨é…ç½®åå¿…é¡»æ‰§è¡Œï¼‰
```bash
sudo systemctl daemon-reload
```
